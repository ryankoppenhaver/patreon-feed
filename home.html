<!DOCTYPE html>
<html lang="en">
<head>
<title></title>
</head>
<body>
<main>
<p>This app scrapes Patreon creator pages to generate syndication feeds for your RSS reader of choice.</p>
<form id="searchForm">
Search for a creator:
<input id="q" />
<button type="submit">search</button>
</form>

<div id="results"></div>

<template id="resultTemplate">
  <div>
</template>

<script type="module">
  import { html, render } from 'https://esm.sh/htm/preact/standalone'

  const Result = ({name, desc, id, url}) => html`
    <div>${name} - ${desc} - <a href=${url}>view on Patreon</a> - <a href="/feed/${id}">feed link</a></div>
  `
  async function doSearch(evt) {
    evt.preventDefault()
    const resDiv = document.getElementById('results')
    resDiv.innerHTML = ''

    const q = encodeURIComponent(document.getElementById('q').value)
    const res = await fetch(`/search?q=${q}`)

    if (!res.ok) {
      console.log(res)
      resDiv.innerText = `search error ${res.status}: ${await res.text()}`
      return
    }

    results = await res.json()

    render(results.map(Result), resDiv)
  }


  document.getElementById('searchForm').addEventListener('submit', doSearch)
</script>




</main>
</body>
</html>
